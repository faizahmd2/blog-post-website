const debouncedListChange=debounce(handleListChange,600);var modalEditor,ckEditor,initialContent=null,postModal=null,postModalId=null;function initScript(){const e=document.getElementById("page-info-hidden");if(!e)return;const t=JSON.parse(e.innerText),o=parseSearchQuery();o.search&&$("#search").val(o.search),$("#pagination").pagination("destroy"),t.totalPage>1?initPagination(t.totalPage,t.currentPage):$(".posts-container").css("max-height","75vh")}function handleListChange(e,t){showLoader(),setSearchQueryParam({search:e,page:t}),getPostsByApi().then((e=>{hideLoader()}))}async function getPostsByApi(){let e=window.location.search,t="/"==window.location.pathname?"r":"p",o="/api/posts/cards"+e;e.includes("?")?o+="&t="+t:o+="?t="+t;let i=await fetchData(o);if(226!=i.status)return notify.error("Some error occured");appendPostsCard(i.decompressedData),initScript()}function initPagination(e,t=1){$("#pagination").pagination({pages:e,currentPage:t,displayedPages:3,cssStyle:"light-theme",onPageClick:function(e,t){t.preventDefault(),showLoader(),handleListChange($("#search").val(),e)}})}function appendPostsCard(e){document.getElementById("all-posts").innerHTML="",$("#all-posts").append(e)}function onCustomCardClicked(e){isLoading||(showModal(),$("#post-modal-parent .title").addClass("placeholder"),getPost(e).then((t=>{initPostModal(t),$("#post-modal-parent .title").removeClass("placeholder"),postModal="compress",postModalId=e})))}async function getPost(e){let t="/api/post/"+e,o=await fetchData(t);return o.success?o:notify.error("Some error occured")}function editModalPublish(){confirm("Are you sure you want to make post public?")&&onPostVisiblityChange("publish")}function editModalPrivate(){confirm("Are you sure you want to make post private?")&&onPostVisiblityChange("private")}function editModalDelete(){confirm("Are you sure you want to delete the post?")&&onCustomCardDelete(postModalId)}function customModalClose(){closeFullscreen(),"quill"!=editorName&&ckEditor&&ckEditor.destroy(),postModal=null,postModalId=null,clearModal()}function onCustomCardDelete(e){isLoading||(showLoader(),deletePost(e).then((e=>{e&&(clearModal(),handleListChange($("#search").val(),""))})))}async function deletePost(e){let t=await fetchData("/api/add-post","PUT",{id:postModalId,type:"remove"});return t.error?notify.error(t.error):t.success?e:notify.error("Some error occured")}function initializeEditor(e){if("quill"==editorName){const t=getToolbarOptions();modalEditor=new Quill("#post-editor",{modules:{toolbar:t},theme:"bubble"});const o=JSON.parse(e);return modalEditor.setContents(o),modalEditor.enable(!1),modalEditor}ckEditorConfig.initialData=e,CKEDITOR.BalloonEditor.create(document.getElementById("post-editor"),ckEditorConfig).then((e=>{(ckEditor=e).enableReadOnlyMode("")})).catch((e=>{console.error(e)}))}function clearModal(){hideModal(),document.getElementById("post-editor").innerHTML="",$("button[edit-modal-publish]").addClass("hide"),$("button[edit-modal-private]").addClass("hide"),$("i[edit-modal]").addClass("hide"),$("button[edit-modal-delete]").addClass("hide"),$("button[edit-modal-save]").addClass("hide"),$("button[edit-modal-clear]").addClass("hide")}function initPostModal(e){$(".custom-model-content .title").text(e.title),e.editable?(e.publish?($("button[edit-modal-publish]").removeClass("hide"),$("button[edit-modal-private]").addClass("hide")):($("button[edit-modal-publish]").addClass("hide"),$("button[edit-modal-private]").removeClass("hide")),$("i[edit-modal]").removeClass("hide"),$("button[edit-modal-delete]").removeClass("hide")):($("i[edit-modal]").addClass("hide"),$("button[edit-modal-delete]").addClass("hide")),initializeEditor(e.content,e.editable)}function onExpandPostModal(){openFullscreen(document.getElementById("post-modal-parent")),$("i[custom-modal-expand]").hide(),$("i[custom-modal-compress]").show();document.querySelector(".custom-modal-parent").classList.add("full"),postModal="expand"}function onCompressPostModal(){closeFullscreen(),$("i[custom-modal-expand]").show(),$("i[custom-modal-compress]").hide();document.querySelector(".custom-modal-parent").classList.remove("full"),postModal="compress"}function toggleFullscreen(e){"compress"==e?onExpandPostModal():"expand"==e&&onCompressPostModal()}function onEditPostModal(){"quill"==editorName?modalEditor&&(initialContent=modalEditor.getContents(),modalEditor.enable(!0),modalEditor.focus()):ckEditor&&(initialContent=ckEditor.getData(),ckEditor.disableReadOnlyMode("")),$("#post-modal-parent .icons i[edit-modal]").addClass("hide"),$("#post-modal-parent .icons button[edit-modal-save]").removeClass("hide"),$("#post-modal-parent .icons button[edit-modal-clear]").removeClass("hide")}async function onSavePostModal(){if(!isLoading){if(showLoader(),modalEditor&&postModalId){const e=modalEditor.getText(0,modalEditor.getLength()),t=JSON.stringify(modalEditor.getContents());if(!e||""==e||e.length<=1)return notify.error("Post Content can't be empty");let o=await fetchData("/api/add-post","PUT",{id:postModalId,contentText:e,content:t,type:"edit"});if(o.error)return notify.error(o.error);if(!o.success)return notify.error("Some error occured");initialContent=null,onClearPostModal()}hideLoader()}}async function onPostVisiblityChange(e){if(!isLoading){if(showLoader(),postModalId){let t=await fetchData("/api/add-post","PUT",{id:postModalId,visiblity:e,type:"visiblity"});if(t.error)return notify.error(t.error);if(!t.success)return notify.error("Some error occured");afterPostVisibiltyChange(e)}hideLoader()}}function afterPostVisibiltyChange(e){let t=`edit-modal-${"publish"==e?"private":"private"==e?"publish":""}`;$(`button[${`edit-modal-${e}`}]`).addClass("hide"),$(`button[${t}]`).removeClass("hide"),notify.success("publish"==e?"Post is Public":"Post is Private")}function onClearPostModal(){initialContent&&("quill"==editorName?(modalEditor.setContents(initialContent),modalEditor.enable(!1)):ckEditor&&(ckEditor.setData(initialContent),ckEditor.enableReadOnlyMode("")),$("#post-modal-parent .icons button[edit-modal-save]").addClass("hide"),$("#post-modal-parent .icons button[edit-modal-clear]").addClass("hide"),$("#post-modal-parent .icons i[edit-modal]").removeClass("hide"))}function getToolbarOptions(){return deviceInfo().mobile?[["bold","italic","underline","strike"],[{align:[]}],["blockquote","code-block"],["link"],[{list:"bullet"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],[{font:[]}]]:[["bold","italic","underline","strike"],[{align:[]}],["blockquote","code-block"],["link","formula"],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{indent:"-1"},{indent:"+1"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],[{font:[]}]]}$(document).ready((function(){initScript(),$("#search").on("input",(function(){debouncedListChange(this.value,"")})),$("#clearSearch").on("click",(function(){handleListChange("",""),$("#search").val("")})),document.addEventListener("fullscreenchange",(function(){document.fullscreenElement||onCompressPostModal()})),document.addEventListener("keydown",(function(e){if("f"===e.key||"F"===e.key)if("quill"==editorName&&modalEditor){let e=modalEditor.hasFocus();postModal&&!e&&toggleFullscreen(postModal)}else ckEditor&&!ckEditor.model.document.isReadOnly&&toggleFullscreen(postModal)}))}));