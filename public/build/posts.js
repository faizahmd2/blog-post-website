const debouncedListChange=debounce(handleListChange,600);var modalEditor,ckEditor,initialContent=null,postModal=null,postModalId=null;function initScript(){const t=document.getElementById("page-info-hidden");if(!t)return;const e=JSON.parse(t.innerText),o=parseSearchQuery();o.search&&$("#search").val(o.search),$("#pagination").pagination("destroy"),e.totalPage>1?initPagination(e.totalPage,e.currentPage):$(".posts-container").css("max-height","75vh")}function handleListChange(t,e){showLoader(),setSearchQueryParam({search:t,page:e}),getPostsByApi().then((t=>{hideLoader()}))}async function getPostsByApi(){let t=window.location.search,e="/"==window.location.pathname?"r":"p",o="/api/posts/cards"+t;t.includes("?")?o+="&t="+e:o+="?t="+e;let i=await fetchData(o);if(226!=i.status)return notify.error("Some error occured");appendPostsCard(i.decompressedData),initScript()}function initPagination(t,e=1){$("#pagination").pagination({pages:t,currentPage:e,displayedPages:3,cssStyle:"light-theme",onPageClick:function(t,e){e.preventDefault(),showLoader(),handleListChange($("#search").val(),t)}})}function appendPostsCard(t){document.getElementById("all-posts").innerHTML="",$("#all-posts").append(t)}function onCustomCardClicked(t){isLoading||(showModal(),$("#post-modal-parent .title").addClass("placeholder"),getPost(t).then((e=>{initPostModal(e),$("#post-modal-parent .title").removeClass("placeholder"),postModal="compress",postModalId=t})))}async function getPost(t){let e="/api/post/"+t,o=await fetchData(e);return o.success?o:notify.error("Some error occured")}function editModalPublish(){confirm("Are you sure you want to make post public?")&&onPostVisiblityChange("publish")}function editModalPrivate(){confirm("Are you sure you want to make post private?")&&onPostVisiblityChange("private")}function editModalDelete(){confirm("Are you sure you want to delete the post?")&&onCustomCardDelete(postModalId)}function customModalClose(){closeFullscreen(),"quill"!=editorName&&ckEditor&&ckEditor.destroy(),postModal=null,postModalId=null,clearModal()}function onCustomCardDelete(t){isLoading||(showLoader(),deletePost(t).then((t=>{t&&(clearModal(),handleListChange($("#search").val(),""))})))}async function deletePost(t){let e=await fetchData("/api/add-post","PUT",{id:postModalId,type:"remove"});return e.error?notify.error(e.error):e.success?t:notify.error("Some error occured")}function initializeEditor(t){if("quill"==editorName){const e=getToolbarOptions();modalEditor=new Quill("#post-editor",{modules:{toolbar:e},theme:"bubble"});const o=JSON.parse(t);return modalEditor.setContents(o),modalEditor.enable(!1),modalEditor}ckEditorConfig.initialData=t,CKEDITOR.BalloonEditor.create(document.getElementById("post-editor"),ckEditorConfig).then((t=>{(ckEditor=t).enableReadOnlyMode("")})).catch((t=>{console.error(t)}))}function clearModal(){hideModal(),document.getElementById("post-editor").innerHTML="",$("button[edit-modal-publish]").addClass("hide"),$("button[edit-modal-private]").addClass("hide"),$("i[edit-modal]").addClass("hide"),$("button[edit-modal-delete]").addClass("hide"),$("button[edit-modal-save]").addClass("hide"),$("button[edit-modal-clear]").addClass("hide")}function initPostModal(t){$(".custom-model-content .title").text(t.title),t.editable?(t.publish?($("button[edit-modal-publish]").removeClass("hide"),$("button[edit-modal-private]").addClass("hide")):($("button[edit-modal-publish]").addClass("hide"),$("button[edit-modal-private]").removeClass("hide")),$("i[edit-modal]").removeClass("hide"),$("button[edit-modal-delete]").removeClass("hide")):($("i[edit-modal]").addClass("hide"),$("button[edit-modal-delete]").addClass("hide")),initializeEditor(t.content,t.editable)}function onExpandPostModal(){openFullscreen(document.getElementById("post-modal-parent")),$("i[custom-modal-expand]").hide(),$("i[custom-modal-compress]").show();document.querySelector(".custom-modal-parent").classList.add("full"),postModal="expand"}function onCompressPostModal(){closeFullscreen(),$("i[custom-modal-expand]").show(),$("i[custom-modal-compress]").hide();document.querySelector(".custom-modal-parent").classList.remove("full"),postModal="compress"}function toggleFullscreen(t){"compress"==t?onExpandPostModal():"expand"==t&&onCompressPostModal()}function onEditPostModal(){"quill"==editorName?modalEditor&&(initialContent=modalEditor.getContents(),modalEditor.enable(!0),modalEditor.focus()):ckEditor&&(initialContent=ckEditor.getData(),ckEditor.disableReadOnlyMode("")),$("#post-modal-parent .icons i[edit-modal]").addClass("hide"),$("#post-modal-parent .icons button[edit-modal-save]").removeClass("hide"),$("#post-modal-parent .icons button[edit-modal-clear]").removeClass("hide")}async function editModalSave(){if(!isLoading){if(showLoader(),"quill"==editorName)onSaveQuillPostModal();else if(ckEditor&&postModalId){const t=ckEditor.getData(),e=stripHtmlTags(t),o=e.split("\n").slice(0,6).join("\n");if(!e||""==e||e.length<=1)return notify.error("Post Content can't be empty");let i=await fetchData("/api/add-post","PUT",{id:postModalId,contentText:o,content:t,type:"edit"});if(i.error)return notify.error(i.error);if(!i.success)return notify.error("Some error occured");initialContent=t,onClearPostModal()}hideLoader()}}async function onSaveQuillPostModal(){if(modalEditor&&postModalId){const t=modalEditor.getText(0,modalEditor.getLength()),e=JSON.stringify(modalEditor.getContents());if(!t||""==t||t.length<=1)return notify.error("Post Content can't be empty");let o=await fetchData("/api/add-post","PUT",{id:postModalId,contentText:t,content:e,type:"edit"});if(o.error)return notify.error(o.error);if(!o.success)return notify.error("Some error occured");initialContent=e,onClearPostModal()}}async function onPostVisiblityChange(t){if(!isLoading){if(showLoader(),postModalId){let e=await fetchData("/api/add-post","PUT",{id:postModalId,visiblity:t,type:"visiblity"});if(e.error)return notify.error(e.error);if(!e.success)return notify.error("Some error occured");afterPostVisibiltyChange(t)}hideLoader()}}function afterPostVisibiltyChange(t){let e=`edit-modal-${"publish"==t?"private":"private"==t?"publish":""}`;$(`button[${`edit-modal-${t}`}]`).addClass("hide"),$(`button[${e}]`).removeClass("hide"),notify.success("publish"==t?"Post is Public":"Post is Private")}function onClearPostModal(){initialContent&&("quill"==editorName?(modalEditor.setContents(initialContent),modalEditor.enable(!1)):ckEditor&&(ckEditor.setData(initialContent),ckEditor.enableReadOnlyMode("")),$("#post-modal-parent .icons button[edit-modal-save]").addClass("hide"),$("#post-modal-parent .icons button[edit-modal-clear]").addClass("hide"),$("#post-modal-parent .icons i[edit-modal]").removeClass("hide"))}function getToolbarOptions(){return deviceInfo().mobile?[["bold","italic","underline","strike"],[{align:[]}],["blockquote","code-block"],["link"],[{list:"bullet"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],[{font:[]}]]:[["bold","italic","underline","strike"],[{align:[]}],["blockquote","code-block"],["link","formula"],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{indent:"-1"},{indent:"+1"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],[{font:[]}]]}$(document).ready((function(){initScript(),$("#search").on("input",(function(){debouncedListChange(this.value,"")})),$("#clearSearch").on("click",(function(){handleListChange("",""),$("#search").val("")})),document.addEventListener("fullscreenchange",(function(){document.fullscreenElement||onCompressPostModal()})),document.addEventListener("keydown",(function(t){if("f"===t.key||"F"===t.key)if("quill"==editorName&&modalEditor){let t=modalEditor.hasFocus();postModal&&!t&&toggleFullscreen(postModal)}else ckEditor&&!ckEditor.model.document.isReadOnly&&toggleFullscreen(postModal)}))}));