let validationInput=[];async function init(){validationInput=isSignup()?["name","username","password","password2"]:["username","password"],resetFormData()}async function submitForm(e){if(e){if(submitFormError())return}let t=getFormData(),s=!isSignup();showLoader();let r=await fetchData(s?"/api/login":"/api/signup","POST",t);if(hideLoader(),r.error)return notify.error(r.error);if(s){if(!r.success)return notify.error("Could Not Login!");notify.success("Logged In Successfully!"),setTimeout((()=>{window.location.href="/"}),700)}else{if(201!=r.status)return notify.error("Could Not Register User!");notify.success("Registered!! Please Login"),toggleSigningMethod()}}function getFormData(e){let t={};if($("input").each((function(){e?$(this).val(""):t[this.name]=$(this).val()})),isSignup()&&$("textarea").each((function(){e?$(this).val(""):t[this.name]=$(this).val()})),!e)return t}function toggleSigningMethod(){let e=new URLSearchParams(window.location.search);isSignup()?e.delete("register"):e.set("register","1"),window.history.replaceState({},"",`${window.location.pathname}?${e}`),window.location.reload()}function isSignup(){return"1"==parseSearchQuery().register}function isAdditional(){if(!isSignup())return null;const e=$(".additional-fields");return"none"!==e.css("display")&&""!==e.css("display")}function toggleAdditionalFields(){let e=isAdditional();null!==e&&(e?($(".additional-fields").hide(),$(".additional-icon").attr("src","/img/icons/slide-down.png")):($(".additional-fields").show(),$(".additional-icon").attr("src","/img/icons/slide-up.png")))}function togglePasswordVisibility(e){let t=".icon-"+e,s=".input-"+e;"password"===$(s).attr("type")?($(s).attr("type","text"),$(t).attr("src","/img/icons/visible.png")):($(s).attr("type","password"),$(t).attr("src","/img/icons/invisible.png"))}function resetFormData(){isSignup()&&$(".additional-fields").hide(),getFormData(!0);for(let e of validationInput)$(`span[err-message='${e}']`).hide(),$(`.input-${e}`).removeClass("error"),$(`.input-${e}`).removeClass("success")}function showError(e,t){const s=$(`span[err-message='${e}']`);if(s.length)s.text(`*${t}`),s.show();else{const s=$("<span>",{"err-message":e,class:"msg red",text:`*${t}`});$("."+e+"-parent").append(s)}}function hideError(e){const t=$(`span[err-message='${e}']`);t.length&&t.hide()}function submitFormError(){for(let e of validationInput){let t=formValid(e,$(`.input-${e}`).val());if(t)return t}return!1}function formValid(e,t){let s=null,r=isSignup();switch(e){case"username":r?(t||(s="Username Required"),t.length<4&&(s="Atleast 4 character required"),t.length>30&&(s="Username too long"),/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(t)||(s="Only alphabets, number and underscore allowed")):t||(s="Username Can't be empty");break;case"password":t||(s="Password Can't be empty"),r&&(t.length<5&&(s="Password must be atleast 5 characters long"),t.length>50&&(s="Password is too long"));break;case"password2":$(".input-password").val()!=t&&(s="Password not matched")}return s}document.addEventListener("DOMContentLoaded",(function(){$("input").on("keyup",(function(e){let t=e.target.name;if(13!==e.keyCode&&validationInput.includes(t)){const s=$(`.input-${t}`);let r=s.hasClass("error"),i=formValid(t,e.target.value);i?(r||s.addClass("error"),showError(t,i)):(r&&s.removeClass("error"),isSignup()&&!s.hasClass("success")&&("username"==t?(showLoader(),fetchData("/api/validate-username","POST",{key:e.target.value}).then((e=>{e.success?s.addClass("success"):e.error&&(s.addClass("error"),showError(t,e.error)),hideLoader()}))):s.addClass("success")),hideError(t))}let s=submitFormError();if(13===e.keyCode)return s?showError(t,s):submitForm();s?$("#submit-btn").addClass("disabled"):$("#submit-btn").removeClass("disabled")})),$("input").on("focusout",(function(e){validationInput.includes(e.target.name)&&$(`.input-${e.target.name}`).removeClass("success")})),init()}));