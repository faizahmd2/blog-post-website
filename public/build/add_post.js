var ckEditor,qEditor,content=localStorage.getItem("post_cached_content");function handleBeforeUnload(t){console.log("UNLOAD",JSON.stringify(t))}function setCacheDataOnLoad(){loadContentFromLocalStorage();let t=localStorage.getItem("post_cached_title"),e=localStorage.getItem("post_cached_publicPost");t&&$("input[name='title']").val(t),e&&(e="true"==e,$("input[name='publicPost']").prop("checked",e))}async function submitForm(){let t=getFormData(),e=formValidationError(t);if(e)return notify.error(e);showLoader();let o=await fetchData("/api/add-post","POST",t);return o.error?notify.error(o.error):o.success?(resetForm(),hideLoader(),notify.success("Post Added Successfully!"),void setTimeout((()=>{window.location.href="/posts"}),700)):notify.error("Some error occured")}function loadContentFromLocalStorage(){const t=localStorage.getItem("post_cached_content");if(t)if("quill"==editorName&&qEditor)try{const e=JSON.parse(t);qEditor.setContents(e)}catch(t){console.error("Error parsing stored content:",t)}else ckEditor&&ckEditor.setData(t)}function resetForm(){"quill"==editorName&&qEditor?qEditor.setText(""):ckEditor&&ckEditor.setData(""),$("input[name='title']").val(""),$("input[name='publicPost']").prop("checked",!1),localStorage.removeItem("post_cached_content"),localStorage.removeItem("post_cached_title"),localStorage.removeItem("post_cached_publicPost")}function formValidationError(t){return t.title&&""!=t.title?!t.contentText||""==t.contentText||t.contentText.length<=1?"Please add post content":null:"Title is Required"}function getFormData(){if("quill"==editorName&&qEditor){const t=qEditor.getText(0,qEditor.getLength());console.log("--------"),console.log(t);const e=JSON.stringify(qEditor.getContents());console.log(e);return{title:$("input[name='title']").val(),content:e,contentText:t,publicPost:$("input[name='publicPost']").prop("checked"),editor:"quill"}}if(ckEditor){const t=ckEditor.getData(),e=stripHtmlTags(t).split("\n").slice(0,6).join("\n");return{title:$("input[name='title']").val(),content:t,contentText:e,publicPost:$("input[name='publicPost']").prop("checked")}}}function stripHtmlTags(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}function getToolbarOptions(){return deviceInfo().mobile?[["bold","italic","underline","strike"],[{align:[]}],["blockquote","code-block"],["link"],[{list:"bullet"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],[{font:[]}]]:[["bold","italic","underline","strike"],[{align:[]}],["blockquote","code-block"],["link","formula"],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],["clean"]]}$(document).ready((function(){if("quill"==editorName){const t=getToolbarOptions();(qEditor=new Quill("#editor",{modules:{toolbar:t},theme:"snow"})).on("text-change",(function(){const t=JSON.stringify(qEditor.getContents());localStorage.setItem("post_cached_content",t)})),setCacheDataOnLoad()}else showLoader(),CKEDITOR.ClassicEditor.create(document.getElementById("editor"),ckEditorConfig).then((t=>{ckEditor=t,setCacheDataOnLoad(),hideLoader(),ckEditor.model.document.on("change:data",(()=>{const t=ckEditor.getData();localStorage.setItem("post_cached_content",t)}))}));$("input[name='title']").on("input",(function(t){localStorage.setItem("post_cached_title",$("input[name='title']").val())})),$("input[name='publicPost']").change((function(t){localStorage.setItem("post_cached_publicPost",$("input[name='publicPost']").prop("checked"))})),$("button[type='submit']").prop("disabled",!1),window.addEventListener("beforeunload",handleBeforeUnload)}));